generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Usuario {
  id_usuario BigInt  @id @default(autoincrement())
  fecha_alta DateTime @default(now()) @db.Timestamp(6)
  email   String
  verificado Boolean @default(false)
  moderador Boolean @default(false)
  nombres     String
  apellidos   String?
  id_region  BigInt?

  comercios UsuariosComercio[]
  region Region? @relation(fields: [id_region], references: [id_region], onDelete: NoAction, onUpdate: NoAction)
  intereses UsuarioPreferencias[]
  reviews_realizadas ReviewProducto[]
  moderaciones LogModeracionReview[]
}

model Comercio {
  id_comercio BigInt @id @default(autoincrement())
  fecha_alta DateTime @default(now()) @db.Timestamp(6)
  nombre String

  vendedores UsuariosComercio[]
  tiendas TiendaFisica[]
  productos_creados Producto[]
}

model UsuariosComercio {
  id_usuario_comercio BigInt @id @default(autoincrement())
  id_usuario BigInt
  id_comercio BigInt
  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  comercio Comercio @relation(fields: [id_comercio], references: [id_comercio], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model TiendaFisica {
  id_tienda      BigInt  @id @default(autoincrement())
  fecha_alta DateTime @default(now()) @db.Timestamp(6)
  id_comercio  BigInt
  nombre         String?
  direccion      String
  id_region      BigInt

  comercio Comercio @relation(fields: [id_comercio], references: [id_comercio], onDelete: NoAction, onUpdate: NoAction)
  region Region? @relation(fields: [id_region], references: [id_region], onDelete: NoAction, onUpdate: NoAction)
  horarios HorarioAbierto[]
  stock_de_productos Stock[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model HorarioAbierto {
  id_registro_horario BigInt    @id @default(autoincrement())
  id_tienda           BigInt
  hora_apertura       DateTime @db.Timestamptz(6)
  hora_cierre         DateTime @db.Timestamptz(6)
  dia_semana          DateTime? @db.Date

  tienda TiendaFisica @relation(fields: [id_tienda], references: [id_tienda], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Producto {
  id_producto     BigInt   @id @default(autoincrement())
  fecha_alta DateTime @default(now()) @db.Timestamp(6)
  nombre          String
  id_tipo            BigInt
  id_autor BigInt
  precio_de_lista Decimal @db.Decimal
  descripcion     String?

  autor Comercio @relation(references: [id_comercio], fields: [id_autor], onDelete: NoAction, onUpdate: NoAction)
  tipo Tipo @relation(references: [id_tipo], fields: [id_tipo], onDelete: NoAction, onUpdate: NoAction)
  generos GeneroProducto[]
  stock_en_tiendas Stock[]
  reviews ReviewProducto[]
}

model Tipo {
  id_tipo BigInt @id @default(autoincrement())
  nombre String

  productos Producto[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Genero {
  id_genero BigInt @id @default(autoincrement())
  nombre    String

  productos GeneroProducto[]
  interesados UsuarioPreferencias[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model GeneroProducto {
  id_genero_producto BigInt  @id @default(autoincrement())
  id_producto        BigInt
  id_genero          BigInt

  producto Producto @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  genero Genero @relation(fields: [id_genero], references: [id_genero], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Stock {
  id_registro_stock BigInt  @id @default(autoincrement())
  id_producto       BigInt
  id_tienda         BigInt
  stock             BigInt

  tienda TiendaFisica @relation(fields: [id_tienda], references: [id_tienda], onDelete: NoAction, onUpdate: NoAction)
  producto Producto @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ReviewProducto {
  id_review    BigInt   @id @default(autoincrement())
  fecha_posteo DateTime @default(now()) @db.Timestamp(6)
  id_usuario   BigInt
  id_producto  BigInt
  texto_review String?
  puntuacion   Int

  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  producto Producto @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  moderado_por LogModeracionReview[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model UsuarioPreferencias {
  id_registro_preferencias BigInt  @id @default(autoincrement())
  id_usuario               BigInt
  id_genero                BigInt

  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  genero Genero @relation(fields: [id_genero], references: [id_genero], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model LogModeracionReview {
  id_logmod_review BigInt  @id @default(autoincrement())
  fecha_mod DateTime @default(now()) @db.Timestamp(6)
  id_moderador BigInt
  id_review         BigInt
  motivo_moderacion String

  moderador Usuario @relation(fields: [id_moderador], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  review ReviewProducto @relation(fields: [id_review], references: [id_review], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Region {
  id_region BigInt  @id @default(autoincrement())
  nombre    String

  usuarios Usuario[]
  tiendas TiendaFisica[]
}